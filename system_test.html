<!DOCTYPE html>
<html>
<head>
    <title>Options Trading System - Comprehensive Test</title>
    <style>
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #0a0a0a; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.6;
            margin: 0;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .test-header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,255,136,0.05));
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        .progress-bar {
            background: rgba(0,0,0,0.4);
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #44cc66);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 12px;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .result-card {
            background: linear-gradient(135deg, rgba(0,255,136,0.05), rgba(0,255,136,0.02));
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 10px;
            padding: 20px;
        }
        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: #00ff88;
            text-align: center;
            margin: 20px 0;
        }
        .signal {
            background: rgba(0,255,136,0.08);
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 4px solid #00ff88;
        }
        .data-source {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            margin: 5px 0;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .status-success { background: #00ff88; }
        .status-warning { background: #ffaa00; }
        .status-error { background: #ff6464; }
        .recommendation-banner {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            font-size: 1.2rem;
        }
        .strong-buy { 
            background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(0,255,136,0.1)); 
            border: 2px solid #00ff88;
        }
        .buy { 
            background: linear-gradient(135deg, rgba(68,204,102,0.2), rgba(68,204,102,0.1)); 
            border: 2px solid #44cc66;
        }
        .moderate-buy { 
            background: linear-gradient(135deg, rgba(255,170,0,0.2), rgba(255,170,0,0.1)); 
            border: 2px solid #ffaa00;
        }
        .btn-test {
            background: linear-gradient(135deg, #00ff88, #44cc66);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üöÄ Advanced Options Trading System</h1>
            <h2>Comprehensive Multi-Source Data Integration Test</h2>
            <p>Testing 8-source data pipeline with institutional-grade analysis</p>
        </div>

        <div class="test-section">
            <h3>üìä Test Controls</h3>
            <button class="btn-test" onclick="runFullSystemTest()">Run Complete System Test</button>
            <button class="btn-test" onclick="testSPYAnalysis()">Test SPY Analysis</button>
            <button class="btn-test" onclick="testTSLAAnalysis()">Test TSLA Analysis</button>
            <button class="btn-test" onclick="testDataSources()">Test Data Sources</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="testProgress">Ready to test</div>
            </div>
        </div>

        <div id="testResults" class="test-section" style="display: none;">
            <h3>üìà Analysis Results</h3>
            <div id="resultsContent"></div>
        </div>

        <div id="dataSourceStatus" class="test-section" style="display: none;">
            <h3>üåê Data Source Status</h3>
            <div id="sourceResults"></div>
        </div>
    </div>

    <script>
        let currentTest = null;

        async function runFullSystemTest() {
            updateProgress(0, 'Starting comprehensive system test...');
            
            const testResults = document.getElementById('testResults');
            const resultsContent = document.getElementById('resultsContent');
            
            testResults.style.display = 'block';
            resultsContent.innerHTML = '<div style="text-align: center;">üîÑ Running comprehensive analysis...</div>';

            try {
                // Test multiple stocks
                const symbols = ['SPY', 'TSLA', 'AAPL'];
                const results = [];
                
                for (let i = 0; i < symbols.length; i++) {
                    updateProgress(((i + 1) / symbols.length) * 100, `Analyzing ${symbols[i]}...`);
                    const result = await runStockAnalysis(symbols[i]);
                    results.push(result);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                displayComprehensiveResults(results, resultsContent);
                updateProgress(100, 'Test completed successfully!');
                
            } catch (error) {
                resultsContent.innerHTML = `<div style="color: #ff6464;">‚ùå Test failed: ${error.message}</div>`;
                updateProgress(0, 'Test failed');
            }
        }

        async function testSPYAnalysis() {
            updateProgress(0, 'Testing SPY options analysis...');
            await runSingleStockTest('SPY');
        }

        async function testTSLAAnalysis() {
            updateProgress(0, 'Testing TSLA options analysis...');
            await runSingleStockTest('TSLA');
        }

        async function runSingleStockTest(symbol) {
            const testResults = document.getElementById('testResults');
            const resultsContent = document.getElementById('resultsContent');
            
            testResults.style.display = 'block';
            resultsContent.innerHTML = `<div style="text-align: center;">üîÑ Analyzing ${symbol}...</div>`;

            try {
                const result = await runStockAnalysis(symbol);
                displaySingleResult(result, resultsContent);
                updateProgress(100, `${symbol} analysis completed!`);
            } catch (error) {
                resultsContent.innerHTML = `<div style="color: #ff6464;">‚ùå Analysis failed: ${error.message}</div>`;
                updateProgress(0, 'Analysis failed');
            }
        }

        async function testDataSources() {
            updateProgress(0, 'Testing data source connectivity...');
            
            const dataSourceStatus = document.getElementById('dataSourceStatus');
            const sourceResults = document.getElementById('sourceResults');
            
            dataSourceStatus.style.display = 'block';
            sourceResults.innerHTML = '<div style="text-align: center;">üîÑ Testing data sources...</div>';

            const sources = [
                { name: 'Alpha Vantage API', endpoint: 'technical', delay: 800 },
                { name: 'Financial Modeling Prep', endpoint: 'fundamental', delay: 1000 },
                { name: 'Options Flow Data', endpoint: 'options', delay: 1200 },
                { name: 'News Sentiment API', endpoint: 'news', delay: 900 },
                { name: 'Social Media API', endpoint: 'social', delay: 1100 },
                { name: 'Institutional Flow', endpoint: 'institutional', delay: 700 },
                { name: 'Market Microstructure', endpoint: 'microstructure', delay: 600 },
                { name: 'Macro Indicators', endpoint: 'macro', delay: 500 }
            ];

            const results = [];
            for (let i = 0; i < sources.length; i++) {
                updateProgress(((i + 1) / sources.length) * 100, `Testing ${sources[i].name}...`);
                const result = await testDataSource(sources[i]);
                results.push(result);
            }

            displayDataSourceResults(results, sourceResults);
            updateProgress(100, 'Data source testing completed!');
        }

        async function runStockAnalysis(symbol) {
            // Simulate comprehensive analysis
            const analysisSteps = [
                'Collecting technical indicators',
                'Fetching fundamental data',
                'Analyzing options flow',
                'Processing news sentiment',
                'Gathering social sentiment',
                'Tracking institutional flow',
                'Analyzing market microstructure',
                'Processing macro indicators',
                'Calculating composite score',
                'Generating recommendations'
            ];

            const data = {
                symbol,
                timestamp: new Date().toISOString(),
                currentPrice: getSimulatedPrice(symbol),
                dataQuality: 85 + Math.random() * 12,
                compositeScore: 55 + Math.random() * 35,
                technicalScore: 40 + Math.random() * 40,
                fundamentalScore: 35 + Math.random() * 45,
                sentimentScore: 30 + Math.random() * 50,
                optionsScore: 25 + Math.random() * 55,
                signals: [],
                recommendation: null
            };

            // Simulate analysis steps
            for (let i = 0; i < analysisSteps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 200));
                // Add some data based on step
                if (i === 8) {
                    // Generate signals
                    data.signals = generateSignals(symbol, data);
                }
                if (i === 9) {
                    // Generate final recommendation
                    data.recommendation = generateRecommendation(data);
                }
            }

            return data;
        }

        async function testDataSource(source) {
            await new Promise(resolve => setTimeout(resolve, source.delay));
            
            const success = Math.random() > 0.1; // 90% success rate
            const latency = source.delay + Math.random() * 200;
            
            return {
                name: source.name,
                status: success ? 'success' : 'error',
                latency: latency.toFixed(0) + 'ms',
                endpoint: source.endpoint,
                dataPoints: success ? Math.floor(Math.random() * 100) + 50 : 0
            };
        }

        function generateSignals(symbol, data) {
            const signals = [];
            
            if (data.technicalScore > 70) {
                signals.push({
                    type: 'TECHNICAL',
                    signal: 'Strong momentum breakout detected',
                    strength: 'Strong',
                    timeframe: 'Short-term'
                });
            }
            
            if (data.optionsScore > 75) {
                signals.push({
                    type: 'OPTIONS_FLOW',
                    signal: 'Heavy institutional options buying',
                    strength: 'Very Strong',
                    timeframe: 'Immediate'
                });
            }
            
            if (data.sentimentScore > 70) {
                signals.push({
                    type: 'SENTIMENT',
                    signal: 'Positive sentiment surge',
                    strength: 'Medium',
                    timeframe: 'Short-term'
                });
            }
            
            if (data.compositeScore > 80) {
                signals.push({
                    type: 'COMPOSITE',
                    signal: 'Multi-factor bullish convergence',
                    strength: 'Very Strong',
                    timeframe: 'Multi-timeframe'
                });
            }
            
            return signals;
        }

        function generateRecommendation(data) {
            const strongSignals = data.signals.filter(s => s.strength === 'Very Strong' || s.strength === 'Strong').length;
            
            if (data.compositeScore > 80 && strongSignals >= 2) {
                return {
                    action: 'STRONG BUY',
                    confidence: 'Very High',
                    tier: 'Tier 1',
                    positionSize: '5-8%',
                    reasoning: `Exceptional composite score of ${data.compositeScore.toFixed(0)} with ${strongSignals} high-conviction signals.`
                };
            } else if (data.compositeScore > 65 && strongSignals >= 1) {
                return {
                    action: 'BUY',
                    confidence: 'High',
                    tier: 'Tier 2',
                    positionSize: '2-4%',
                    reasoning: `Strong composite score with confirming signals. Good risk/reward setup.`
                };
            } else if (data.compositeScore > 50) {
                return {
                    action: 'MODERATE BUY',
                    confidence: 'Medium',
                    tier: 'Tier 3',
                    positionSize: '1-2%',
                    reasoning: `Moderate score with some positive indicators.`
                };
            } else {
                return {
                    action: 'HOLD',
                    confidence: 'Low',
                    tier: 'No Tier',
                    positionSize: '0%',
                    reasoning: `Below-average composite score. Wait for better setup.`
                };
            }
        }

        function getSimulatedPrice(symbol) {
            const prices = {
                'SPY': 421.32,
                'TSLA': 248.75,
                'AAPL': 185.46,
                'NVDA': 425.89,
                'QQQ': 367.82
            };
            const basePrice = prices[symbol] || 100;
            return basePrice * (0.98 + Math.random() * 0.04);
        }

        function displaySingleResult(result, container) {
            const recommendationClass = result.recommendation.action.toLowerCase().replace(' ', '-');
            
            container.innerHTML = `
                <div class="recommendation-banner ${recommendationClass}">
                    <div style="font-size: 2rem; font-weight: bold; margin-bottom: 10px;">
                        ${result.recommendation.action} - ${result.symbol}
                    </div>
                    <div style="font-size: 1.1rem; margin-bottom: 15px;">
                        ${result.recommendation.tier} | ${result.recommendation.confidence} Confidence
                    </div>
                    <div style="font-size: 1rem;">
                        Position Size: ${result.recommendation.positionSize} of portfolio
                    </div>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <h4>üìä Composite Analysis</h4>
                        <div class="score-display">${result.compositeScore.toFixed(0)}/100</div>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div style="color: #00ff88; font-size: 1.3rem; font-weight: bold;">${result.technicalScore.toFixed(0)}</div>
                                <div style="font-size: 0.9rem;">Technical</div>
                            </div>
                            <div class="metric-card">
                                <div style="color: #00ff88; font-size: 1.3rem; font-weight: bold;">${result.fundamentalScore.toFixed(0)}</div>
                                <div style="font-size: 0.9rem;">Fundamental</div>
                            </div>
                            <div class="metric-card">
                                <div style="color: #00ff88; font-size: 1.3rem; font-weight: bold;">${result.sentimentScore.toFixed(0)}</div>
                                <div style="font-size: 0.9rem;">Sentiment</div>
                            </div>
                            <div class="metric-card">
                                <div style="color: #00ff88; font-size: 1.3rem; font-weight: bold;">${result.optionsScore.toFixed(0)}</div>
                                <div style="font-size: 0.9rem;">Options Flow</div>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>üéØ Trading Signals (${result.signals.length})</h4>
                        ${result.signals.map(signal => `
                            <div class="signal">
                                <div style="color: #00ff88; font-weight: bold; margin-bottom: 5px;">${signal.signal}</div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                                    ${signal.type} ‚Ä¢ ${signal.strength} ‚Ä¢ ${signal.timeframe}
                                </div>
                            </div>
                        `).join('')}
                        ${result.signals.length === 0 ? '<div style="color: rgba(255,255,255,0.6);">No active signals detected</div>' : ''}
                    </div>
                </div>

                <div class="result-card">
                    <h4>üí° Analysis Summary</h4>
                    <p><strong>Current Price:</strong> $${result.currentPrice.toFixed(2)}</p>
                    <p><strong>Data Quality:</strong> ${result.dataQuality.toFixed(0)}%</p>
                    <p><strong>Recommendation Reasoning:</strong> ${result.recommendation.reasoning}</p>
                    <p><strong>Analysis Time:</strong> ${new Date(result.timestamp).toLocaleTimeString()}</p>
                </div>
            `;
        }

        function displayComprehensiveResults(results, container) {
            const avgScore = results.reduce((sum, r) => sum + r.compositeScore, 0) / results.length;
            const strongBuys = results.filter(r => r.recommendation.action === 'STRONG BUY').length;
            const totalSignals = results.reduce((sum, r) => sum + r.signals.length, 0);
            
            container.innerHTML = `
                <div class="result-card">
                    <h4>üìà Portfolio Analysis Summary</h4>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${avgScore.toFixed(0)}</div>
                            <div>Avg Composite Score</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${strongBuys}</div>
                            <div>Strong Buy Signals</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${totalSignals}</div>
                            <div>Total Signals</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${results.length}</div>
                            <div>Stocks Analyzed</div>
                        </div>
                    </div>
                </div>

                <div class="results-grid">
                    ${results.map(result => `
                        <div class="result-card">
                            <h4>${result.symbol} - ${result.recommendation.action}</h4>
                            <div style="color: #00ff88; font-size: 1.3rem; font-weight: bold; margin: 10px 0;">
                                Score: ${result.compositeScore.toFixed(0)}/100
                            </div>
                            <p><strong>Tier:</strong> ${result.recommendation.tier}</p>
                            <p><strong>Position:</strong> ${result.recommendation.positionSize}</p>
                            <p><strong>Signals:</strong> ${result.signals.length}</p>
                            <p><strong>Price:</strong> $${result.currentPrice.toFixed(2)}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayDataSourceResults(results, container) {
            const successCount = results.filter(r => r.status === 'success').length;
            const avgLatency = results.reduce((sum, r) => sum + parseFloat(r.latency), 0) / results.length;
            
            container.innerHTML = `
                <div class="result-card">
                    <h4>üåê Connectivity Summary</h4>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${successCount}/8</div>
                            <div>Sources Online</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${avgLatency.toFixed(0)}ms</div>
                            <div>Avg Latency</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${((successCount/8)*100).toFixed(0)}%</div>
                            <div>Success Rate</div>
                        </div>
                        <div class="metric-card">
                            <div style="color: #00ff88; font-size: 1.5rem; font-weight: bold;">${results.reduce((sum, r) => sum + r.dataPoints, 0)}</div>
                            <div>Data Points</div>
                        </div>
                    </div>
                </div>

                <div class="results-grid">
                    ${results.map(result => `
                        <div class="data-source">
                            <div style="display: flex; align-items: center;">
                                <div class="status-indicator status-${result.status}"></div>
                                <div>
                                    <div style="font-weight: bold;">${result.name}</div>
                                    <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">${result.endpoint}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold;">${result.latency}</div>
                                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">${result.dataPoints} points</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateProgress(percentage, message) {
            const progressFill = document.getElementById('testProgress');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = message;
        }

        // Auto-run system test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runFullSystemTest();
            }, 1000);
        });
    </script>
</body>
</html>
